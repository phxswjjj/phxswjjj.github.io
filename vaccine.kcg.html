<html>

<head>
    <style>
    </style>
</head>

<body>
    <div id="root">
        <div>
            <a href="https://vaccine.kcg.gov.tw/Reserve" target="_blank">高雄市新冠肺炎疫苗接種預約系統</a>
        </div>
        <hr />
        <div id="condition">
            <div>
                <span>名稱(like):</span><input id="txtName" type="text" value="莫德納" />
            </div>
            <div>
                <input id="btnQuery" type="button" onclick="LoadData(this)" value="Query" />
            </div>
        </div>
        <hr />
        <div id="content"></div>
    </div>
    <script>
        const corsUrl = 'https://cors-anywhere.herokuapp.com/';

        function LoadData(el) {
            if (!el) el = document.querySelector('#btnQuery');
            el.disabled = true;

            let content = document.querySelector('#content');
            console.dir(content);
            content.innerText = 'loading...';

            let url = 'https://vaccine.kcg.gov.tw/api/Common/HealthCenters?town=';
            let options = {};
            fetch(`${corsUrl}${url}`, options)
                .then((resp) => {
                    if (!resp.ok)
                        throw { message: resp.statusText };

                    return resp.json();
                })
                .then((list) => {
                    content.innerHTML = '';
                    let likeName = txtName.value;

                    list.forEach((data) => {
                        if (likeName && !data.name.includes(likeName)) return;

                        let found = data.servicePeriods.find(s => s.isFull);
                        if (!found) return;
                        let place = document.createElement('div');
                        place.innerHTML = `${data.town}-${data.name}`;
                        content.appendChild(place);
                    });

                    el.disabled = false;
                })
                .catch((ex) => {
                    console.log('error', ex.message);
                    content.innerText = ex.message;
                });
        }

        LoadData();
    </script>
</body>

</html>